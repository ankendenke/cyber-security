In the previous task, we identified a backdoor account that the attacker created and gained access to. However, we should take a step back and determine how the attacker got the privileges to create that account in the first place. To expand our investigation into the system's users and groups, we should also look into each user's personal directory, files, history, and configurations.

User Home Directories

User home directories in Linux contain personalised settings, configurations, and user-specific data. These directories are typically located under the `/home` directory and are named after the corresponding usernames on the system. Recall viewing the `/etc/passwd` file and identifying various users and their home directories.

We can list out the home directories with a simple `ls -l` command:

Listing the /home Directories

```shell-session
investigator@10.10.33.136:~$ ls -l /home
total 16
drwxr-xr-x 4 bob          bob          4096 Feb 12 19:32 bob
drwxr-xr-x 3 investigator investigator 4096 Feb 13 02:22 investigator
drwxr-xr-x 4 jane         jane         4096 Feb 13 00:36 jane
drwxr-xr-x 5 ubuntu       ubuntu       4096 Feb 12 21:23 ubuntu
```

Hidden Files

Hidden files, identified by a leading dot in their filenames, often store sensitive configurations and information within a user's home directory. By default, we cannot list out these hidden files using `ls`. To view them, we need to provide the `-a` argument, which will include all entries starting with a dot.

To list out the hidden files within Jane's home directory, run:

Listing Jane's Hidden Files and Directories

```shell-session
investigator@10.10.33.136:~$ ls -a /home/jane
.  ..  .bash_history  .bash_logout  .bashrc  .cache  .profile  .ssh
```

Some common files that would be of interest during an investigation include:

- **.bash_history**: This file contains a user's command history and can be used to show previous commands executed by the user.
- **.bashrc** and **.profile**: These are configuration files used to customise a user's Bash shell sessions and login environment, respectively.

Additionally, we can look at other files and directories of interest, like browser profiles and the `.ssh` directory.

SSH and Backdoors

The `.ssh` directory is a susceptible area containing configuration and key files related to SSH connections. The `authorized_keys` file within the directory is critical because it lists public keys allowed to connect to a user's account over SSH.

If a malicious user gains unauthorised access to a system and wants to persistently access another user's account (for example, Jane's account) by adding their public key to the `authorized_keys` file, we can potentially uncover artefacts that hint at these actions.

First, navigate to the `.ssh` directory within Jane's home folder. From here, we can run an `ls -al` to list the contained files:

Listing Jane's .sshDirectory

```shell-session
investigator@10.10.33.136:~$ ls -al /home/jane/.ssh
total 20
drwxr-xr-x 2 jane jane 4096 Feb 12 17:15 .
drwxr-xr-x 4 jane jane 4096 Feb 13 00:36 ..
-rw-rw-rw- 1 jane jane 1136 Feb 13 00:34 authorized_keys
-rw------- 1 jane jane 3389 Feb 12 17:12 id_rsa
-rw-r--r-- 1 jane jane  746 Feb 12 17:12 id_rsa.pub
```

Let's view the file to see if we can identify any unintended authorised public keys:

Viewing Jane's authorized_keys Entries

```shell-session
investigator@10.10.33.136:~$ cat /home/jane/.ssh/authorized_keys 
ssh-rsa ******************** jane@ip-10-10-25-169
ssh-rsa ******************** backdoor
```

Notice that there are two entries. The first belongs to Jane, as signified by the ending comment. However, the second entry appears to be related to an entirely different keypair with the comment "backdoor". The attacker was likely able to edit this file and append their own public key, allowing them SSH access as Jane.

We can further confirm this by returning to the `stat` command. By running it on the file, we can see that it was last modified around a similar timeframe to when we confirmed the attacker gained an initial foothold on the system.

Viewing the Timestamps on the authorized_keys File

```shell-session
investigator@10.10.33.136:~$ stat /home/jane/.ssh/authorized_keys 
  File: /home/jane/.ssh/authorized_keys
  Size: 1136      	Blocks: 8          IO Block: 4096   regular file
Device: ca01h/51713d	Inode: 257561      Links: 1
Access: (0666/-rw-rw-rw-)  Uid: ( 1002/    jane)   Gid: ( 1002/    jane)
Access: 2024-02-13 00:34:53.692530853 +0000
Modify: ****-**-** **:**:**.********* +****
Change: 2024-02-13 00:34:16.005897449 +0000
 Birth: -
```

If we look back to the output of the `ls -al` command, we can identify the permission misconfiguration that made this possible:

Viewing the Permissions of the authorized_keys File

```shell-session
investigator@10.10.33.136:~$ ls -al /home/jane/.ssh/authorized_keys 
-rw-rw-rw- 1 jane jane 1136 Feb 13 00:34 /home/jane/.ssh/authorized_keys
```

As identified by the third `rw` permissions, this file is world-writable, which should never be the case for sensitive files. Consequently, by exploiting this misconfiguration, the attacker gained unauthorised SSH access to the system as if they were Jane.